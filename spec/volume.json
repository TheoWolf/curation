{
  "$schema": "http://json-schema.org/schema#",
  "title": "Databrary Volume",
  "description": "Basic organizational unit for data.",
  "definitions": {
    "date": {
      "type": "string",
      "format": "date-time",
      "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
    },
    "citation": {
      "description": "Publications/products corresponding to study volumes.",
      "type": "object",
      "properties": {
        "head": {"type": "string"},
        "title": {"type": "string"},
        "url": {"type": "string",
          "title": "URL or DOI",
          "format": "uri"
        },
        "authors": {"type": "array",
          "items": {"type": "string"}
        },
        "year": {"type": "integer",
          "minimum": 1900,
          "maximum": 2900
        }
      },
      "required": ["head"],
      "additionalProperties": false
    },
    "container": {
      "title": "session or materials",
      "description": "Organizational unit within volume containing related files (with common annotations), often corresponding to an individual data session (single visit/acquisition/participant/group/day).",
      "type": "object",
      "properties": {
        "name": {"type": "string"},
        "date": {"$ref": "#/definitions/date"},
        "top": {"type": "boolean",
          "default": false
        },
        "consent": {
          "description": "Sharing/release permissions granted by participants on (portions of) contained data.",
          "anyOf": [
            {"$ref": "#/definitions/consent"},
            {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "segment": {"$ref": "#/definitions/segment"},
                  "consent": {"$ref": "#/definitions/consent"}
                },
                "required": ["segment", "consent"]
              }
            }
          ],
          "default": null
        },
        "records": {
          "description": "Attachment of records to slots.",
          "type": "array",
          "items": {"$ref": "#/definitions/record"}
        },
        "assets": {
          "description": "Attachment point of assets, which, in the case of timeseries data, should match asset.duration.",
          "type": "array",
          "items": {"$ref": "#/definitions/asset"}
        }
      },
      "additionalProperties": false
    },
    "consent": {
      "title": "participant release",
      "description": "Levels of sharing that participants may consent to.",
      "enum": [null, "PRIVATE", "SHARED", "EXCERPTS", "PUBLIC"]
    },
    "classification": {
      "description": "Data (file or measure)-level settings affecting permissions.",
      "enum": ["PRIVATE", "RESTRICTED", "SHARED", "PUBLIC"]
    },
    "offset": {
      "description": "Point in time, used as endpoint for segment.  Null represents indeterminate value, usually representing +-Infinity as an endpoint.",
      "type": ["number", "null"]
    },
    "segment": {
      "description": "Explicit range of time (within a container): an empty segment, a singleton point in time, or a start and end point.",
      "type": "array",
      "items": {"$ref": "#/definitions/offset"},
      "maxItems": 2,
      "additionalItems": false,
      "default": [null, null]
    },
    "position": {
      "default": [null, null]
    },
    "record": {
      "description": "Sets of metadata measurements organized into or applying to a single cohesive unit. These are assumed to be unique within a volume, such that two identical records are considered the same object.",
      "type": "object",
      "properties": {
        "category": {
          "description": "Types of records that are relevant for data organization.",
          "enum": [null, "pilot", "exclusion", "participant", "condition", "group", "context"]
        },
        "segment": {"$ref": "#/definitions/segment"},
        "ident": {"type": "string"},
        "reason": {"type": "string",
          "enum": ["Did not meet inclusion criteria","Procedural/experimenter error","Withdrew/fussy/tired","Outlier"]
        },
        "summary": {"type": "string"},
        "description": {"type": "string"},
        "birthdate": {"$ref": "#/definitions/date"},
        "gender": {"type": "string",
          "enum": ["Female","Male"]
        },
        "race": {"type": "string",
          "enum": ["American Indian or Alaska Native","Asian","Native Hawaiian or Other Pacific Islander","Black or African American","White","Multiple"]
        },
        "ethnicity": {"type": "string",
          "enum": ["Not Hispanic or Latino","Hispanic or Latino"]
        },
        "disability": {"type": "string"},
        "language": {"type": "string"},
        "setting": {"type": "string",
          "enum": ["Lab","Home","Classroom","Outdoor","Clinic"]
        },
        "country": {"type": "string"},
        "state": {"type": "string",
          "enum": ["AL","AK","AZ","AR","CA","CO","CT","DE","DC","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","MD","MA","MI","MN","MS","MO","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"]
        },
        "info": {"type": "string"},
        "gestational age (weeks)": {"type": "number"}
      },
      "required": ["category"]
    },
    "asset": {
      "title": "file",
      "description": "Assets reflecting files in primary storage.",
      "type": "object",
      "properties": {
        "classification": {"$ref": "#/definitions/classification"},
        "name": {"type": "string"},
        "segment": {"anyOf": [
          {"$ref": "#/definitions/offset",
            "description": "Start point only (end point inferred from length)."
          },
          {"$ref": "#/definitions/segment"},
          {"type": "string",
            "enum": ["auto"],
            "description": "Automatically postioned immediately following previous positioned asset."
          }
        ]},
        "file": {"type": "string",
          "description": "Relative path to file under '/nyu/stage/'."
        },
        "clip": {"$ref": "#/definitions/segment",
          "description": "Portion of source file to extract as this asset. Note that segment is relative to clip start."
        }
      },
      "required": ["classification"],
      "additionalProperties": false
    }
  },
  "type": "object",
  "properties": {
    "name": {"type": "string"},
    "body": {"type": "string",
      "title": "description or abstract"
    },
    "alias": {"type": "string",
      "title": "internal short name",
      "description": "Short, internal, code name for this volume, for contributors to reference their own data."
    },
    "citation": {"$ref": "#/definitions/citation"},
    "containers": {"type": "array",
      "items": {"$ref": "#/definitions/container"},
      "description": "The first container is required and must have 'top' set.",
      "minItems": 1
    }
  },
  "required": ["name", "containers"],
  "additionalProperties": false
}
